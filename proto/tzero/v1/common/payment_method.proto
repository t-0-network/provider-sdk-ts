syntax = "proto3";

package tzero.v1.common;

import "tzero/v1/common/common.proto";
import "buf/validate/validate.proto";

enum PaymentMethodType {
  PAYMENT_METHOD_TYPE_UNSPECIFIED = 0;
  PAYMENT_METHOD_TYPE_SEPA = 10;
  PAYMENT_METHOD_TYPE_SWIFT = 20;
  PAYMENT_METHOD_TYPE_CARD = 30; // only pay in
  PAYMENT_METHOD_TYPE_STABLECOIN = 40; // only pay out
  PAYMENT_METHOD_TYPE_ACH = 50;
  PAYMENT_METHOD_TYPE_WIRE = 60;
  PAYMENT_METHOD_TYPE_FPS = 70;
  PAYMENT_METHOD_TYPE_M_PESA = 80;
  PAYMENT_METHOD_TYPE_G_CASH = 90;
  PAYMENT_METHOD_TYPE_INDIAN_BANK_TRANSFER = 100;
}

message PaymentDetails {
  oneof details {
    option (buf.validate.oneof).required = true;
    // SEPA (Single Euro Payments Area) - Euro bank transfers across European countries
    Sepa sepa = 10;

    //SWIFT (Society for Worldwide Interbank Financial Telecommunication) - International wire transfers
    // Global (200+ countries)
    Swift swift = 30;

    // Stablecoin - Cryptocurrency transfers pegged to fiat currencies
    // Global
    Stablecoin stablecoin = 40;

    // ACH (Automated Clearing House) - Electronic bank-to-bank transfers
    // United States
    Ach ach = 50;

    // Wire - Domestic electronic funds transfer
    // United States
    Wire wire = 60;

    // FPS (Faster Payments Service)
    // United Kingdom
    Fps fps = 70;

    // M-Pesa - Mobile money transfer and payment service
    // Kenya, Tanzania, Mozambique, DRC, Lesotho, Ghana, Egypt, South Africa
    MPesa mpesa = 80;

    // GCash - Mobile wallet and payment platform
    // Philippines
    GCash gcash = 90;

    // Indian Bank Transfer - Domestic electronic funds transfer (IMPS/NEFT/RTGS)
    // India
    IndianBankTransfer  indian_bank_transfer = 100;
  };

  message Sepa {
    string iban = 20 [(buf.validate.field).string = {
      min_len: 15,
      max_len: 34,
      pattern: "^[A-Z]{2}[0-9]{2}[A-Z0-9]+$"
    }];
    string beneficiary_name = 30 [(buf.validate.field).string = {
      min_len: 1,
      max_len: 70
    }];
    string payment_reference = 40 [(buf.validate.field).string = {
      max_len: 140
    }];
  }

  message Fps {
    string sort_code = 10 [(buf.validate.field).string = {
      min_len: 6,
      max_len: 8,
      pattern: "^([0-9]{2}-[0-9]{2}-[0-9]{2}|[0-9]{6})$"
    }];
    string account_number = 20 [(buf.validate.field).string = {
      min_len: 8,
      max_len: 8,
      pattern: "^[0-9]{8}$"
    }];
    string beneficiary_name = 30 [(buf.validate.field).string = {
      min_len: 1,
      max_len: 18
    }];
    string reference = 40 [(buf.validate.field).string = {
      max_len: 18
    }];
  }

  message MPesa {
    // Phone number in international format without + sign
    // Examples: 254708374149 (Kenya), 255712345678 (Tanzania), 256712345678 (Uganda)
    // Required: Yes
    string beneficiary_phone = 10 [(buf.validate.field).string = {
      min_len: 10,
      max_len: 15,
      pattern: "^[0-9]{10,15}$"
    }];

    // Account reference (max 12 chars, alphanumeric)
    // Required: Yes
    string account_reference = 20 [(buf.validate.field).string = {
      min_len: 1,
      max_len: 12,
      pattern: "^[a-zA-Z0-9]+$"
    }];
  }

  message GCash {
    string beneficiary_name = 10 [(buf.validate.field).string = {
        min_len: 1,
        max_len: 100
      }];

      // Recipient phone
    string beneficiary_phone = 20 [(buf.validate.field).string = {
      min_len: 10,
      max_len: 20,
      pattern: "^[+]?[0-9]+$"
    }];

    string payment_reference = 30 [(buf.validate.field).string = {
      max_len: 140,
    }];

  }

  message IndianBankTransfer {

    oneof method {
      option (buf.validate.oneof).required = true;

      // 1) ACCOUNT + IFSC (NEFT/RTGS/IMPS P2A)
      AccountIFSC account_ifsc = 10;

      // 2) IMPS P2P (MOBILE + MMID)
      IMPS imps = 20;
    }

    message AccountIFSC {
      // Beneficiary bank account number
      string account_number = 10 [(buf.validate.field).string = {
        min_len: 9,
        max_len: 18,
        pattern: "^[0-9]{9,18}$"
      }];

      // IFSC code (11 characters: 4 letters + '0' + 6 alphanumeric).
      string ifsc = 20 [(buf.validate.field).string = {
        min_len: 11,
        max_len: 11,
        pattern: "^[A-Z]{4}0[A-Z0-9]{6}$"
      }];
    }

    //Method 2: IMPS P2P (Mobile + MMID)
    message IMPS {
      // Indian mobile number (10 digits, starting from 6â€“9).
      string beneficiary_phone = 10 [(buf.validate.field).string = {
        pattern: "^[6-9][0-9]{9}$",
        min_len: 10,
        max_len: 10
      }];

      // MMID: 7-digit Mobile Money Identifier.
      string mmid = 20 [(buf.validate.field).string = {
        pattern: "^[0-9]{7}$",
        min_len: 7,
        max_len: 7
      }];
    }

    // Beneficiary name
    string beneficiary_name = 30 [(buf.validate.field).string = {
      min_len: 1,
      max_len: 70
    }];

    // Beneficiary type
    string beneficiary_type = 40 [(buf.validate.field).string = {
      min_len: 8,
      max_len: 30
    }];

   string payment_reference = 50 [(buf.validate.field).string = {
      max_len: 140,
    }];
  }

  message Swift {
    // Beneficiary's bank SWIFT/BIC code (8 or 11 characters)
    string swift_code = 10 [(buf.validate.field).string = {
      min_len: 8,
      max_len: 11,
      pattern: "^[A-Z]{4}[A-Z]{2}[A-Z0-9]{2}([A-Z0-9]{3})?$"
    }];

    // Beneficiary's account number (format varies by country)
    // Could be IBAN, account number, or other format
    string account_number = 20 [(buf.validate.field).string = {
      min_len: 1,
      max_len: 34
    }];

    // Beneficiary's full name
    string beneficiary_name = 30 [(buf.validate.field).string = {
      min_len: 1,
      max_len: 140
    }];

    // Beneficiary's address
    string beneficiary_address = 40 [(buf.validate.field).string = {
      min_len: 1,
      max_len: 255
    }];

    string payment_reference = 50 [(buf.validate.field).string = {
      max_len: 140
    }];
  }

  message Stablecoin {
    tzero.v1.common.Blockchain blockchain = 10 [(buf.validate.field).required = true];

    tzero.v1.common.Stablecoin stablecoin = 20 [(buf.validate.field).required = true];

    string address = 30 [(buf.validate.field).string = {
      min_len: 20,
      max_len: 64,
      pattern: "^(0x)?[a-fA-F0-9]+$"
    }];
  }

  message Ach {
    string routing_number = 10 [(buf.validate.field).string = {
      min_len: 9,
      max_len: 9,
      pattern: "^[0-9]{9}$"
    }];

    string account_number = 20 [(buf.validate.field).string = {
      min_len: 1,
      max_len: 17,
      pattern: "^[0-9]+$"
    }];

    string account_holder_name = 30 [(buf.validate.field).string = {
      min_len: 1,
      max_len: 70
    }];

    AchAccountType account_type = 40 [(buf.validate.field).enum = {
      not_in: [0]
    }];

    enum AchAccountType {
      ACH_ACCOUNT_TYPE_UNSPECIFIED = 0;
      ACH_ACCOUNT_TYPE_CHECKING = 10;
      ACH_ACCOUNT_TYPE_SAVINGS = 20;
    }
  }

  message Wire {
    string bank_name = 10 [(buf.validate.field).string = {
      min_len: 1,
      max_len: 70
    }];

    string bank_address = 20 [(buf.validate.field).string = {
      min_len: 1,
      max_len: 140
    }];

    string swift_code = 30 [(buf.validate.field).string = {
      min_len: 8,
      max_len: 11,
      pattern: "^[A-Z]{6}[A-Z0-9]{2}([A-Z0-9]{3})?$"
    }];

    string account_number = 40 [(buf.validate.field).string = {
      min_len: 1,
      max_len: 34
    }];

    string beneficiary_name = 50 [(buf.validate.field).string = {
      min_len: 1,
      max_len: 70
    }];

    string beneficiary_address = 60 [(buf.validate.field).string = {
      min_len: 1,
      max_len: 140
    }];

    string wire_reference = 70 [(buf.validate.field).string = {
      max_len: 140
    }];
  }
}
